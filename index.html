// NOVA FUNÇÃO IMPLEMENTADA
        window.sugerirPerdaComIA = async function(button) {
            const form = button.closest('form');
            const nomeInsumo = form.nome.value;
            const resultadoContainer = form.querySelector('#perda-ia-resultado');
            const desperdicioInput = form.percentualDesperdicio;

            if (!nomeInsumo) {
                alert("Por favor, insira o nome do insumo para obter uma sugestão de perda.");
                return;
            }

            resultadoContainer.innerHTML = `<div class="flex items-center"><span class="spinner"></span> Pesquisando sugestão...</div>`;
            resultadoContainer.classList.remove('hidden');
            button.disabled = true;

            const prompt = `Como um consultor de food service, estime o percentual de desperdício médio para o insumo "${nomeInsumo}" durante o pré-preparo em uma cozinha profissional (ex: cascas, sementes, aparas, ossos). Forneça apenas o número do percentual, sem o símbolo '%' ou qualquer texto adicional. Por exemplo, se a estimativa for 15%, retorne apenas "15".`;

            try {
                const resposta = await callGeminiAPI(prompt);
                const percentualSugerido = parseFloat(resposta);

                if (!isNaN(percentualSugerido)) {
                    desperdicioInput.value = percentualSugerido.toFixed(0);
                    resultadoContainer.innerText = `Sugestão da IA: ${percentualSugerido.toFixed(0)}%. O valor foi inserido no campo acima.`;
                } else {
                    resultadoContainer.innerHTML = `<p class="text-orange-600 font-semibold">A IA retornou uma resposta inesperada:</p><p class="text-sm text-gray-700">${resposta}</p>`;
                }
            } catch (error) {
                resultadoContainer.innerHTML = `<p class="text-red-600 font-semibold">Ocorreu um erro:</p><p class="text-sm text-gray-700">${error.message}</p>`;
            } finally {
                button.disabled = false;
            }
        }
